{
    "contents" : "install.packages(\"maps\")\ninstall.packages(\"dplyr\")\ninstall.packages(\"ggplot2\")\n\nlibrary(ggplot2)\nlibrary(maps)\nlibrary(dplyr)\nlibrary(plyr)\n\ndata.neic <- read.table(\"data/2014_NEIC_declustered.c4.csv\", header = TRUE, sep = \",\")\n\ndata.anss <- read.table(\"data/anss.csv\", header = TRUE, sep = \",\")\ncolnames(data.anss) <- c(\"datetime\",\"lat\",\"lon\",\"dp.km\",\"mag\",\"magtype\",\"nbstations\", \"gap\", \"distance\", \"rms\", \"source\", \"eventid\")\n\nstations.iris <- read.table(\"data/out_fetchmdata_sept15\", header = FALSE, sep = \"|\")\ncolnames(stations.iris) <- c(\"net\",\"sta\",\"loc\",\"chan\",\"lat\",\"lon\",\"elev\",\"depth\",\"azimuth\",\"dip\",\"instrument\",\"scale\",\"scalefreq\",\"scaleunits\",\"samplerate\",\"start\",\"end\")\n\n\n# Magnitude to mw\ndata.anss$emw <- ifelse(data.anss$magtype == \"ML\", 0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Mb\", 0.7813*data.anss$mag + 1.5175,\n                   ifelse(data.anss$magtype == \"Md\", 0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Mx\", -1,\n                   ifelse(data.anss$magtype == \"Mh\", -1,\n                   ifelse(data.anss$magtype == \"Mc\",0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Unk\", -1, -2)))))))\n\n\n#FIXME: Why do I have bad values?\ndata.anss <- subset(data.anss, data.anss$emw > 0)\n\n# Date formatting\ndata.neic$datetime <- ISOdatetime(data.neic$y, data.neic$m, data.neic$d, data.neic$h, data.neic$m.1, data.neic$s, tz = \"\")\nstations.iris$start <- strptime(stations.iris$start,format=\"%Y-%m-%dT%H:%M:%OS\")\nstations.iris$end <- strptime(stations.iris$end,format=\"%Y-%m-%dT%H:%M:%OS\")\n#add miliseconds to format\n#stations.iris$start <- options(digits.secs=3)\n#stations.iris$end  <- options(digits.secs=3)\n#options(stations.iris$start) #reset options\n#options(stations.iris$end) #reset options\n\n# Rename lon and lat\ndata.neic$lon <- data.neic$lon.dE.\ndata.neic$lat <- data.neic$lat.dN.\ndata.neic$lon.dE. <- data.neic$lat.dN. <- data.neic$y <- data.neic$m <- data.neic$d <- data.neic$h <- data.neic$m.1 <- data.neic$s <- NULL\n\n# Filter based on lat and long\n# FIXME Merge is not working.\nm <- rbind.fill(data.neic, data.anss)\nm <- dplyr::bind_rows(data.neic, data.anss)\n\ndataset <- subset(m, lat >= 35.5 & lat <= 43.5 & lon <= -71 & lon >= -84 )\n\ntarget_states <- c( \"pennsylvania\", \"new york\", \"new jersey\", \"virginia\", \"kentucky\",\"rhode island\",\n                    \"massachusetts\",\"vermont\",\"new hampshire\", \"delaware\", \"maryland\", \"west virginia\", \n                    \"north carolina\", \"tennessee\", \"ohio\", \"connecticut\", \"district of columbia\" )\nall_states <- map_data(\"state\")\ncounty <- map_data(\"county\")\n\n\nstates <- subset(all_states, region %in% target_states)\ncounty <- subset(county, region %in% target_states)\n\np <- ggplot() +\n  geom_polygon(aes(long,lat, group=group), fill=\"palegreen3\", colour=\"grey60\", data=county) +\n  geom_polygon( data=states, aes(x=long, y=lat, group = group),colour=\"royalblue4\", fill=NA) +\n  annotate(\"rect\", xmin=-84, xmax=-71, ymin=35.5, ymax=43.5, colour=\"black\", size=1, fill=\"blue\", alpha=\"0.01\") +\n  geom_point(size=1, alpha = .7, aes(dataset$lon, dataset$lat, color=dataset$emw)) +\n  scale_color_gradient(low=\"blue\", high=\"red\") +\n  theme(plot.background = element_rect(fill = 'grey')) +\n  geom_abline(intercept = 3, slope = -.45, color = \"blue\", size = 1)",
    "created" : 1443453828109.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3618743990",
    "id" : "882CA4BD",
    "lastKnownWriteTime" : 1443454355,
    "path" : "~/GitHub/intraplate-seismicity/import.R",
    "project_path" : "import.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}