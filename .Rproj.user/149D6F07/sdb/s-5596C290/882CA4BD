{
    "contents" : "install.packages(\"maps\")\ninstall.packages(\"dplyr\")\ninstall.packages(\"ggplot2\")\ninstall.packages(\"fpc\", dependencies = TRUE)\ninstall.packages(\"fossil\")\n\nlibrary(ggplot2)\nlibrary(maps)\nlibrary(dplyr)\nlibrary(plyr)\nlibrary(fpc)\nlibrary(fossil)\n\n# Utility function:  DO NOT EDIT\nmoveme <- function (invec, movecommand) {\n  movecommand <- lapply(strsplit(strsplit(movecommand, \";\")[[1]], \n                                 \",|\\\\s+\"), function(x) x[x != \"\"])\n  movelist <- lapply(movecommand, function(x) {\n    Where <- x[which(x %in% c(\"before\", \"after\", \"first\", \n                              \"last\")):length(x)]\n    ToMove <- setdiff(x, Where)\n    list(ToMove, Where)\n  })\n  myVec <- invec\n  for (i in seq_along(movelist)) {\n    temp <- setdiff(myVec, movelist[[i]][[1]])\n    A <- movelist[[i]][[2]][1]\n    if (A %in% c(\"before\", \"after\")) {\n      ba <- movelist[[i]][[2]][2]\n      if (A == \"before\") {\n        after <- match(ba, temp) - 1\n      }\n      else if (A == \"after\") {\n        after <- match(ba, temp)\n      }\n    }\n    else if (A == \"first\") {\n      after <- 0\n    }\n    else if (A == \"last\") {\n      after <- length(myVec)\n    }\n    myVec <- append(temp, values = movelist[[i]][[1]], after = after)\n  }\n  myVec\n}\n\n\n\ndata.neic <- read.table(\"data/2014_NEIC_declustered.c4.csv\", header = TRUE, sep = \",\")\n\ndata.anss <- read.table(\"data/anss.csv\", header = TRUE, sep = \",\")\ncolnames(data.anss) <- c(\"datetime\",\"lat\",\"lon\",\"dp.km\",\"mag\",\"magtype\",\"nbstations\", \"gap\", \"distance\", \"rms\", \"source\", \"eventid\")\n\nstations.iris <- read.table(\"data/out_fetchmdata_sept15\", header = FALSE, sep = \"|\")\ncolnames(stations.iris) <- c(\"net\",\"sta\",\"loc\",\"chan\",\"lat\",\"lon\",\"elev\",\"depth\",\"azimuth\",\"dip\",\"instrument\",\"scale\",\"scalefreq\",\"scaleunits\",\"samplerate\",\"start\",\"end\")\n\n\n# Magnitude to mw\ndata.anss$emw <- ifelse(data.anss$magtype == \"ML\", 0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Mb\", 0.7813*data.anss$mag + 1.5175,\n                   ifelse(data.anss$magtype == \"Md\", 0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Mx\", -1,\n                   ifelse(data.anss$magtype == \"Mh\", -1,\n                   ifelse(data.anss$magtype == \"Mc\",0.806*data.anss$mag + 0.633,\n                   ifelse(data.anss$magtype == \"Unk\", -1, -2)))))))\n\n\n#FIXME: Why do I have bad values?\ndata.anss <- subset(data.anss, data.anss$emw > 0)\n\n# Date formatting\ndata.neic$datetime <- ISOdatetime(data.neic$y, data.neic$m, data.neic$d, data.neic$h, data.neic$m.1, data.neic$s, tz = \"\")\ndata.anss$datetime <- as.POSIXct(data.anss$datetime, tz = \"\")\nstations.iris$start <- strptime(stations.iris$start,format=\"%Y-%m-%dT%H:%M:%OS\")\nstations.iris$end <- strptime(stations.iris$end,format=\"%Y-%m-%dT%H:%M:%OS\")\n#add miliseconds to format\n#stations.iris$start <- options(digits.secs=3)\n#stations.iris$end  <- options(digits.secs=3)\n#options(stations.iris$start) #reset options\n#options(stations.iris$end) #reset options\n\n# Rename lon and lat\ndata.neic$lon <- data.neic$lon.dE.\ndata.neic$lat <- data.neic$lat.dN.\ndata.neic$lon.dE. <- data.neic$lat.dN. <- data.neic$y <- data.neic$m <- data.neic$d <- data.neic$h <- data.neic$m.1 <- data.neic$s <- NULL\n\n# Filter based on lat and long\nm <- rbind.fill(data.neic, data.anss)\nm <- dplyr::bind_rows(data.neic, data.anss)\n\ndataset <- subset(m, lat >= 35.5 & lat <= 43.5 & lon <= -71 & lon >= -84 )\n\n# Calculate distance matrix for the purposes of clustering.\ncoordinates  <- data.frame(long=dataset$lon, lat=dataset$lat)\ndist  <- earth.dist(df, dist=T)\ndens<-dbscan(dist,MinPts=25,eps=0.43,method=\"dist\")\n\n\ntarget_states <- c( \"pennsylvania\", \"new york\", \"new jersey\", \"virginia\", \"kentucky\",\"rhode island\",\n                    \"massachusetts\",\"vermont\",\"new hampshire\", \"delaware\", \"maryland\", \"west virginia\", \n                    \"north carolina\", \"tennessee\", \"ohio\", \"connecticut\", \"district of columbia\" )\nall_states <- map_data(\"state\")\ncounty <- map_data(\"county\")\n\nstates <- subset(all_states, region %in% target_states)\ncounty <- subset(county, region %in% target_states)\n\np <- ggplot() +\n  geom_polygon(aes(long,lat, group=group), fill=\"palegreen3\", colour=\"grey60\", data=county) +\n  geom_polygon( data=states, aes(x=long, y=lat, group = group),colour=\"royalblue4\", fill=NA) +\n  annotate(\"rect\", xmin=-84, xmax=-71, ymin=35.5, ymax=43.5, colour=\"black\", size=1, fill=\"blue\", alpha=\"0.01\") +\n  geom_point(size=2, alpha = .7, aes(dataset$lon, dataset$lat, color=dataset$emw)) +\n  scale_color_gradient(low=\"blue\", high=\"red\") +\n  theme(plot.background = element_rect(fill = 'grey')) +\n  geom_abline(intercept = 3, slope = -.45, color = \"blue\", size = 1)\n\nd <- dbscan(dataset, 10,showplot = 2)",
    "created" : 1443453828109.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2265512244",
    "id" : "882CA4BD",
    "lastKnownWriteTime" : 1443461237,
    "path" : "~/GitHub/intraplate-seismicity/import.R",
    "project_path" : "import.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}